# 关注点

1. 性能监测工具（enableDebugTools)

   > ng.profiler.timeChangeDetection({record: true})可以触发变更检测，并记录平均每次tick的时间

3. 异步发送多个请求后合并结果会导致tick几次？

   > 批量操作通过this._ngZone.runOutsideAngular完成计算后再tick?
   >
   > 复杂计算请移到runOutsideAngular内部

   ```
   ajax请求回来的事件会触发一次tick
   多个请求会触发多次
   用fockJoin合并也会触发多次
   ```

4. onPush & markForCheck & changeDefects & detach &retach

   angular变更检测发生在onMicrotaskEmpty清空之后(micro task为空就会触发)，所以对于事件、macro task来说回调执行完就会执行变更检测

   > immutable

   > markForCheck是否会导致父级更新？比如父级onPush，input未更新，那么子级markForCheck时父级是否进行更新？
   >
   > changeDefects是否是只更新当前组件及子组件？

4. ngxs注册多个监听时，只更新一处是否会倒致多处监听触发？(己验证)

   发送多个action请在runOutsideAngular内部干

   > 注意：ngxs每次dispatch都会倒致一次tick， ngxs dispatch会倒致一次postMessage
   >
   > dispatch里面传数组时，每个action倒致一次tick

   ```
   select方法在使用时最好使用@Selector定义好的函数，这样会缓存，否则只要有变化就触发
   //下面的写法在每次有dispatch	action时都会触发
   this.store.select(state => state).subscibe(state => console.log('=====>', state))
   
   //下面的写法只有corpType发生变化时才触发临听
   @Select(CorpInfoState.companyType) companyType$: Observable<number>
   corpType$.subscribe(companyType => console.log('=======>', companyType))
   
   this.store.select(CorpInfoState.corpInfo)等效于下面的：
   @Select(CorpInfoState.corpInfo) corpInfo$: Observable<number>
   corpType$.subscribe(corpInfo => console.log('=======>', corpInfo))
   
   dispatch companyType时companyType及其父对象corpInfo都变了，所以两个都有触发
   
   dispatch corpType时只有父对象corpInfo变了，所以只触发corpInfo的监听
   dispatch accountType时都没有变化，一个监听都不触发
   ```

5. destroy时监听destroyUtil是否会倒致一次tick? (己验证，不会触发)

6. form存在多个监听时，能否做到只有当前值修改了才触发（默认一处修改全部触发）

7. trackBy

8. 部分组件被render多次（oninit触发多次，能否加一些工具方法来认别出组件存在多次实例化？）

9. pipe  (己验证)

   > 异步pipe不会比较值，只要next就会执行
   >
   > 普通pipe只要有变更检测就会执行
   >
   > ngxs的translate pipe不是pure pipe, 它用取值时用选返回一个observable，然后subscribe（估计是同步的）然后在值的回调方法里面markForCheck(如果组件是onPush这样会不会倒致父级更新？)，虽然tranlate不是pure的，段是它在内部做了translate方法内部做了cached，在取值之前会先对比，但感觉还是不如pure

   ```
   使用pure pipe(pure pipe在执行前会和之前的值做比较，如果没有变化就直接用旧的值):
   @Pipe({
       name: "util",
       pure: true
   })
   ```

10. 模块表达示优化

    尽量选将需要的值在类里面计算好，这样在模块里就无须多次计算

    > 减少函数的调用
    >
    > 变更检测时运行模块函数会运行模块中的函数，变更检测后的值校验会再次运行对应的函数生成新的值并对比新老值

11. 静态内容cache (将公用模板统一query出来保存并调用)

12. 事件代理

    > angular没有事件代理，事件直接注册在对应的DOM元素上，列表中涉及事件操作时最好多事件代理

13. 用代码代替ngFor

    ```
    <tr *ngFor="let item of items; trackBy: trackById;" class="h-12">
      <td>
        <span>{{ item.label }}</span>
      </td>
    </tr>
    
    代码是知道什么时候去执行的，用ngFor的话模块函数执行时就会执行一遍
    <tbody>
      <ng-container #itemsContainer></ng-container>
    </tbody>
    <ng-template #item let-item="item">
      <tr class="h-12">
        <td>
          <span>{{ item.label }}</span>
        </td>
      </tr>
    </ng-template>
    
    for (let n = start; n <= end; n++) {
        this.container.createEmbeddedView(this.template, {
          item: {
            label: Math.random()
          }
        });
    }
    ```

14. 虚拟滚动

15. webworker

    ```
    费时计算webworker
    ```

16. 懒加载 & preload

17. Treeshake

18. preserveWhitespaces

       删除空白字符，默认为preserveWhitespaces:false不保留

       ```
       aot可以配置：
       tsconfig.json
       "angularCompilerOptions": {
       	"preserveWhitespaces": false,
       }
       
       jit:
       bootstrapModule(AppModule, { preserveWhitespaces: false})
       ```

19. router在跳转时会触发多次tick(第一次是popstate, 在监听器里面有个setTimeout())